---
title: "Trends in Data Science Job Postings on Stack Overflow"
author: "Benjamin Ackerman"
date: "October 4, 2017"
mainfont: Times New Roman
output: 
  pdf_document:
    latex_engine: xelatex
fontsize: 12pt
geometry: margin=1in
---

```{r setup, echo=FALSE, warning=FALSE,message=FALSE,results='hide'}
packages = c("devtools","qdapRegex","knitr","dplyr","kableExtra","ggmap","leaflet","stringr","tidyr","tm","SnowballC","wordcloud","RColorBrewer","rebus","maps","grid","cowplot","RgoogleMaps","ggplot2")
lapply(packages,library,character.only=TRUE)
```

```{r test setup, include=FALSE}
opts_chunk$set(dev = 'pdf')
```
## Introduction
- Increased demand for data scientists, hot new field, Stack Overflow's popularity

## Research Aim
The purpose of this paper is to examine trends in job postings for "data scientists" on the Stack Overflow job board.  This involves determing the most common computing skills that employers look for, where geographically most jobs are located, degree and area of study preferences among employers, and how these have changed over time.

## Data
Data were made privately available upon request from David Robinson, a Data Scientist at Stack Overflow.  The provided data consist of information from jobs posted on the Stack Overflow job board that either have "data scientist" or "data analyst" in their title, and were posted between August 25, 2010 and September 25, 2017.  While company names were censored from the data, the following attributes of each posting were provided in a data frame: job title, original posting date, associated tags indicating relevant skills, job location (City, State, Country), salary (when included), and the full text of job descriptions and requirements.

- Extracted the following for each posting in the data provided:
    + Month and year when the job was posted
    + Degree requirement for the job (Bachelors, Masters, PhD)
    + Preferred majors/departments for the job
    + Latitude and longitude of the job location using the `geocode` function in the `ggmap` package
    
## Methods
- Exploratory data analysis
    + Counted number of times each major/department was listed
    + Counted number of times each degree type was listed
    + Tabulated number of job postings by month and year
    + Tabulated city locations
- Generated hex maps of US and Europe to view where most jobs are located
- Comparison of US and Europe jobs: what characteristics are more likely to land a person a job in Europe vs US?

## Results
```{r load data,echo=FALSE}
stackjobs = readRDS("../stackjobs.rds")
```

```{r jitter latitude and longitude functions,echo=FALSE}
length_of_degree <- function(degree, type = c("lat", "long")) {
  type <- match.arg(type)
  length_at_equator <- 110.5742727 # in kilometers
  if (type == "long") {
    cos(degree * (2 * pi) / 360) * length_at_equator
  } else if (type == "lat") {
    length_at_equator
  }
}
jitter_latlong <- function(coord, type = c("lat", "long"), latitude, km = 1) {
  type = match.arg(type)
  if(missing(latitude) & type == "lat") latitude <- coord
  km_per_degree <- length_of_degree(latitude, type = type)
  degree_per_km <- 1 / km_per_degree
  coord + (runif(1, min = -1, max = 1) * degree_per_km * km)
}
jitter_latlong <- Vectorize(jitter_latlong,
                            vectorize.args = c("coord", "latitude"))
```

```{r actual map,echo=FALSE,warning=FALSE,message=FALSE,fig.align='center',fig.height=4,fig.width=10}
mapdat_us = stackjobs %>% 
  group_by(LocationString) %>% 
  count() %>% 
  inner_join(stackjobs,by="LocationString") %>% 
  filter(CountryCode == "US") %>% 
  mutate(region = "USA")

us=ggplot()+borders(database="state")+geom_hex(data=mapdat_us, mapping=aes(x=lon,y=lat), bins=15,alpha=.8)+scale_fill_gradient(low = "yellow", high = "red")+theme(
              legend.position="none",
              axis.title.x = element_blank(),
               axis.line = element_blank(),
               axis.text.x=element_blank(),
               axis.ticks.x=element_blank(),
               axis.title.y = element_blank(),
               axis.text.y=element_blank(),
               axis.ticks.y=element_blank())

mapdat_eu = stackjobs %>% 
  group_by(LocationString) %>% 
  count() %>% 
  inner_join(stackjobs,by="LocationString") %>%
  filter(CountryCode %in% c("AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","GB")) %>% 
  mutate(region = "EU")

europe=ggplot()+borders(database="world",xlim=c(-10,25),ylim=c(40,70))+geom_hex(data=mapdat_eu, mapping=aes(x=lon,y=lat), bins=15,alpha=.8)+scale_fill_gradient("# of Jobs",low = "yellow", high = "red")+theme(
               axis.title.x = element_blank(),
               axis.line = element_blank(),
               axis.text.x=element_blank(),
               axis.ticks.x=element_blank(),
               axis.title.y = element_blank(),
               axis.text.y=element_blank(),
               axis.ticks.y=element_blank(),
               legend.title=element_text(size=10),
               legend.text=element_text(size=10))

cowplot::plot_grid(us,europe, labels = c(paste0("USA (n=",nrow(mapdat_us),")"), paste0("Europe (n=",nrow(mapdat_eu),")")), align = "v")
```

```{r popular majors, echo=FALSE, results='tex',eval=FALSE}
pop_majors = data.frame(sort(table(unlist(stackjobs$majors)),decreasing=TRUE))
names(pop_majors) = c("Major","n")
kable(pop_majors[1:10,],caption="10 most common majors listed in job postings")
```

```{r top tags, echo=FALSE,warning=FALSE,message=FALSE,fig.align='center',fig.height=4,fig.width=10}
toptags = stackjobs %>% 
  ungroup() %>% 
  .$Tags %>% 
  str_split(" ") %>% 
  unlist() %>% 
  str_replace_all("-"," ") %>% 
  data.frame(tags=.,stringsAsFactors=FALSE) %>% 
  group_by(tags) %>% 
  count() %>% 
  arrange(desc(n)) %>% 
  filter(!is.na(tags))

tags = ggplot(toptags[1:10,], aes(reorder(tags,n),n)) + geom_col() + coord_flip() + labs(y="Count",x="Tags")

topmajors = stackjobs %>% 
  .$majors %>% 
  unlist() %>% 
  data.frame(majors=.,stringsAsFactors=FALSE) %>% 
  group_by(majors) %>% 
  count() %>% 
  arrange(desc(n)) %>% 
  filter(!is.na(majors))

majors = ggplot(topmajors[1:10,], aes(reorder(majors,n),n)) + geom_col() + coord_flip() + labs(y="Count",x="Departments")

cowplot::plot_grid(tags,majors, labels = c("Top 10 Tags in Listings","Top 10 Areas of Study in Listings"), align = "v",scale = 0.9)
```



## Discussion/Limitations

## Conclusion